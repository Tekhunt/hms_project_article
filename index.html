<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->

    <title>Hello, world!</title>
    <link rel="stylesheet" href="style.css">
  </head> 
  </body>
  <div class="main">
    <div class="top">
      <a href="">#WEbApp</a> <a href="">#Django</a> <a href="">#Python</a>
    </div>
   
    <h1 class="center-top">django</h1>
  

  <h2 class="head">Hotel Management Project</h2>
  <hr class="hrule">
  <p>Django is a high-level Python web framework that encourages rapid development and clean, pragmatic design. Built by experienced developers, it takes care of much of the hassle of web development, so you can focus on writing your app without needing to reinvent the wheel. It’s free and open source.</p>

  <h2>Advantages of using django</h2>
 
  <ul class="ul">
    <li>Django provides a default admin panel</li> 
    <li> Django comes with couple of cool libraries that will make work easier for developer.</li>
    <li>It improves search engine optimization</li>
    <li>Django has strong security</li>
    <li>Django comes with a roburst admin panel which is customizable</li>
    <li> Django has great Object relational Mapper</li>
    <li> Highly Scalable</li>
    <li> HElps developers build applications faster</li>
    <li> Django comes fully loaded with tools needed to accomplish app developement tasks like Authentication, site maps, RSS feeds etc.</li>
    <li> Can be used to develop any type of application</li>
  </ul>
 <h2>Requirements</h2>
 <ol class="ul">
   <li> Visit <a href="https://www.python.org/downloads/">this link</a> to install python 3 if you don't have it installed in your machine</li>
   <li>Download VScode <a href="https://code.visualstudio.com/download">here</a> if you wish to use it for this project</li>
   <li>Click <a href="https://git-scm.com/downloads">here</a> to download git bash</li>
 </ol>
  <p></p>
  <p>Follows the instructions below and code along or code the code snippets to your IDE</p>
  <p>I used VScode to build this project. You may want to use vscode or your preferred IDE, you shiould get the same result irrespective</p>
 

  <h2 class="heading">Create a vitual Environment</h2>
  <p>We will be using Python's package manager pip to install this and other packages like Django which we will require later on. First, let's get virtualenv installed.</p>
   

<pre>


pip install virtualenv
   
</pre>

 <p>Once that is done, create a folder called projects anywhere you like (I created mine in the documents folder) then cd into it.</p>


 <pre>
  

mkdir hotel_system


</pre>

<pre>

  
cd hotel_system


</pre>
<p>Once inside the projects folder, create another folder called hms. This folder will hold our app.</p>

<pre>


mkdir hms


</pre>

<p>At this point, we need to create the environment to hold our requirements. We will do this inside the hms folder.</p>
 
<pre>


virtualenv hotelenv


</pre>
<p>Now we need to actvate our virtual environment</p>

<h2>Install Django</h2>

<pre>


pip install django


</pre>

<p>The above code snippets will install django into the virtual environment created in our project folder</p>
<pre>


pip install psycopg2_binary


</pre>
<p>This package is the postgres engine that will enable us use postgres database in our project</p>

<h2>Create project and apps</h2>

<p>After you’ve successfully installed Django, you’re ready to create the scaffolding for your new web application.
  A Django project is a high-level unit of organization that contains logic that governs your whole web application. Each project can contain multiple apps while Django app is a lower-level unit of your web application. You can have zero to many apps in a project, and you’ll usually have at least one app. You’ll learn more about apps in the next section. </p>

<pre class="line-numbers"> 
  <code class="language-python">

django-admin startproject name 
    
 </code>

   
</pre>

<p>Here our project name is hotel_system. You may choose to replace name with your preferred project name. Now let's create an Authentication app. Remember to use your name of choice for the app name</p>

<pre class="line-numbers"> 
  <code class="language-python">

python manage.py startapp name
    
 </code>


</pre>

<p>

<h2>Git Setup</h2>
<p>Follow the steps below to set up git and workflows for this project</p>
<ul class="ul">
  <li>Create and checkout to a new git branch called (use any name of your choice). And in this branch</li>
  <li>Create a .github folder. In this folder </li>
  <li>Create PULL_REQUEST_TEMPLATE.md file and add PR format of your choice.
  </li>
  <li>Create a workflow folder and add ci.yml file and implement configuration for continuous integration
  </li>
  <li>Make a commit for your changes in the setup_ci branch and push the branch to your repository
  </li>
  <li>Visit the repository on Github and create a pull request from the branch and merge it to master or main branch
  </li>
  <li>Go back to GIT and checkout to master and pull the merged changes into your local master.
  </li>
  <li>So you start the cycle again for each part of the tutorial and name each branch the topic treated in the part.
  </li>
</ul>
<p>Create a .env file inside the project folder and configure your database settings as shown below.
</p>
<pre class="line-numbers"> 
  <code class="python">
    SECRET_KEY=django-insecure-63yz=-tc&x51kjvazxle%=32mmu8!t7h(a*bq#u0!rx1xw!m%u
    DATABASE_NAME=hoteldb
    DATABASE_USER=postgres
    DATABASE_PASS=PASSWORD
    DATABASE_PORT=5432
    DATABASE_HOST=localhost
    Hotel-system/hotelsystem/manage.py
    /Users/decagon/Documents/hotelproject/Hotel-system/hotelsystem/manage.py
 </code>

   
</pre>

<p>Create a .gitignore file and add .env file in your .gitignore file</p>

<p>Got setings.py inside the project folder and include our apps in the list of install apps. Befoe this, follow the steps above on how to create python app and 
  create three more apps namely: 'booking', 'Receptionist' and 'customer'. Bravo! Now follow the snippet below.
</p>
<pre class="line-numbers"> 
  <code class="language-python">

    INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'authentication',
    'booking',
    'Receptionist',
    'customer',
    'rest_framework',
]
    
 </code>
</pre>

<h2>Database setup</h2>
 <p>Follow these steps to configure your your postgresql database </p>

 <pre class="line-numbers"> 
  <code class="language-python">

    DATABASES = {
      'default': {
          'ENGINE': 'django.db.backends.postgresql_psycopg2',
          'NAME': env('DATABASE_NAME'),
          'USER' : env('DATABASE_USER'),
          'PASSWORD' : env('DATABASE_PASS'),
          'PORT' : env('DATABASE_PORT'),
          'HOST' : env('DATABASE_HOST')
      }
  }
    
 </code>
</pre>

<p>Let us configure our template folder. The folder tells django where to look for templates ie html files for your apps.
  In the code below, we update the 'DIR' field with the path to out templates folder.
</p>

<pre class="line-numbers"> 
  <code class="language-python">

    TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [os.path.join(BASE_DIR,'templates')],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]
    
 </code>
</pre>

<p>Let us configure static and media directories</p>
<pre class="line-numbers"> 
  <code class="language-python">

    STATIC_URL = '/static/'
    STATIC_ROOT=os.path.join(BASE_DIR,'static')
    MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
    MEDIA_URL = '/media/'
    
    
 </code>

   
</pre>


<p>Now let us create our models for these apps and make migrations</p>

<h2>Authentication app models</h2>
<pre class="line-numbers"> 
  <code class="language-python">

    from django.db import models
    from PIL import Image
    class Customer(models.Model):
        username=models.CharField(max_length=100)
        password=models.CharField(max_length=100)
        email=models.CharField(max_length=50)
        profile_pic=models.ImageField(upload_to="media", height_field=None, width_field=None, max_length=None,blank=True)
        phone_no=models.CharField(max_length=50)
        address=models.TextField()
        state=models.CharField(max_length=30,blank=True)
        pin_code=models.IntegerField(blank=True)
        def __str__(self):
            return "Customer: "+self.username
        
    class RoomManager(models.Model):
        username=models.CharField(max_length=100)
        password=models.CharField(max_length=100)
        email=models.CharField(max_length=50)
        profile_pic=models.ImageField(upload_to="media", height_field=None, width_field=None, max_length=None,blank=True)
        phone_no=models.CharField(max_length=50)
        gender=models.CharField(max_length=20)
        def __str__(self):
            return "Room Manager: "+self.username
    
    
 </code>
</pre>

<p>Open the admin.py file and register the models as shown below</p>
<pre>
  <code>
    from django.contrib import admin
    from authentication.models import Customer, RoomManager
    admin.site.register(Customer)
    admin.site.register(RoomManager)
  </code>
</pre>

<h2>Paste the code below in the views.py file of the Authentication app</h2>

<pre>
  <code>

                    from django.shortcuts import render,redirect
                    from .models import Customer,RoomManager
                    from django.contrib.auth.hashers import make_password,check_password
                    from django.contrib import messages
                    #mesages.info(request,'mail taken')
                    def user_login(request):
                        if request.session.get('username',None) and request.session.get('type',None)=='customer':
                            return redirect('user_dashboard')
                        if request.session.get('username',None) and request.session.get('type',None)=='manager':
                            return redirect('manager_dashboard')
                        if request.method=="POST":
                            username=request.POST['username']
                            password=request.POST['password']
                            if not len(username):
                                messages.warning(request,"Username field is empty")
                                redirect('user_login')
                            elif not len(password):
                                messages.warning(request,"Password field is empty")
                                redirect('user_login')
                            else:
                                pass
                            if Customer.objects.filter(username=username):
                                user=Customer.objects.filter(username=username)[0]
                                password_hash=user.password
                                res=check_password(password,password_hash)
                                if res==1:
                                    request.session['username'] = username
                                    request.session['type'] = 'customer'
                                    return render(request,'booking/index.html',{})
                                else:
                                    messages.warning(request,"Username or password is incorrect")
                                    redirect('user_login')
                            else:
                                messages.warning(request,"No, Account exist for the given Username")
                                redirect('user_login')
                        else:
                            redirect('user_login')
                        return render(request,'login/user_login.html',{})
                        
                    def manager_login(request):
                        if request.session.get('username',None) and request.session.get('type',None)=='customer':
                            return redirect('user_dashboard')
                        if request.session.get('username',None) and request.session.get('type',None)=='manager':
                            return redirect('manager_dashboard')
                        if request.method=="POST":
                            username=request.POST['username']
                            password=request.POST['password']
                            if not len(username):
                                messages.warning(request,"Username field is empty")
                                redirect('manager_login')
                            elif not len(password):
                                messages.warning(request,"Password field is empty")
                                redirect('manager_login')
                            else:
                                pass
                            if RoomManager.objects.filter(username=username):
                                user=RoomManager.objects.filter(username=username)[0]
                                password_hash=user.password
                                res=check_password(password,password_hash)
                                if res==1:
                                    request.session['username'] = username
                                    request.session['type'] = 'manager'
                                    return render(request,'booking/index.html',{})
                                else:
                                    messages.warning(request,"Username or password is incorrect")
                                    redirect('manager_login')
                            else:
                                messages.warning(request,"No, Account exist for the given Username")
                                redirect('manager_login')
                        else:
                            redirect('manager_login')
                        return render(request,'login/manager_login.html',{})
                    def user_signup(request):
                        if request.session.get('username',None) and request.session.get('type',None)=='customer':
                            return redirect('user_dashboard')
                        if request.session.get('username',None) and request.session.get('type',None)=='manager':
                            return redirect('manager_dashboard')
                        if request.method=="POST":
                            username=request.POST['username']
                            email=request.POST['email']
                            if Customer.objects.filter(username=username) or Customer.objects.filter(email=email):
                              messages.warning(request,"Account already exist, please Login to continue")
                            else:
                                password=request.POST['password']
                                address=request.POST['address']
                                pin_code=request.POST['pin_code']
                                profile_pic=request.FILES.get('profile_pic',None)
                                phone_no=request.POST['phone_no']
                                state=request.POST['state']
                                error=[]
                                if(len(username)<3):
                                    error.append(1)
                                    messages.warning(request,"Username Field must be greater than 3 character.")
                                if(len(password)<5):
                                    error.append(1)
                                    messages.warning(request,"Password Field must be greater than 5 character.")
                                if(len(email)==0):
                                    error.append(1)
                                    messages.warning(request,"Email field can't be empty")
                                if(len(phone_no)!=10):
                                    error.append(1)
                                    messages.warning(request,"Valid Phone number is a 10 digit-integer.")
                                if(len(error)==0):
                                    password_hash = make_password(password)
                                    customer=Customer(username=username,password=password_hash,email=email,phone_no=phone_no,
                                    address=address,state=state,pin_code=pin_code,profile_pic=profile_pic)
                                    customer.save()
                                    messages.info(request,"Account Created Successfully, please Login to continue")
                                    redirect('user_signup')
                                else:
                                    redirect('user_signup')
                            
                        else:
                            redirect('user_signup')
                        return render(request,'login/user_login.html',{})
                    def manager_signup(request):
                        if request.session.get('username',None) and request.session.get('type',None)=='customer':
                            return redirect('user_dashboard')
                        if request.session.get('username',None) and request.session.get('type',None)=='manager':
                            return redirect('manager_dashboard')
                        if request.method=="POST":
                            username=request.POST['username']
                            email=request.POST['email']
                            if RoomManager.objects.filter(username=username) or RoomManager.objects.filter(email=email):
                              messages.warning(request,"Account already exist, please Login to continue")
                            else:
                                password=request.POST['password']
                                profile_pic=request.FILES.get('profile_pic',None)
                                phone_no=request.POST['phone_no']
                                error=[]
                                if(len(username)<3):
                                    error.append(1)
                                    messages.warning(request,"Username Field must be greater than 3 character.")
                                if(len(password)<5):
                                    error.append(1)
                                    messages.warning(request,"Password Field must be greater than 5 character.")
                                if(len(email)==0):
                                    error.append(1)
                                    messages.warning(request,"Email field can't be empty")
                                if(len(phone_no)!=10):
                                    error.append(1)
                                    messages.warning(request,"Valid Phone number is a 10 digit-integer.")
                                if(len(error)==0):
                                    password_hash = make_password(password)
                                    r_manager=RoomManager(username=username,password=password_hash,email=email,
                                    phone_no=phone_no,profile_pic=profile_pic)
                                    r_manager.save()
                                    messages.info(request,"Account Created Successfully, Please login to continue")
                                    redirect('manager_signup')
                                else:
                                    redirect('manager_signup')
                            
                        else:
                            redirect('user_signup')
                        return render(request,'login/manager_login.html',{})
                    def logout(request):
                        if request.session.get('username', None):
                            del request.session['username']
                            del request.session['type']
                            return render(request,"login/logout.html",{})
                        else:
                            return render(request,"login/user_login.html",{})
                    
                    
                    
          </code>
        </pre>

        <h2>Now go to the urls.py of the Authenication app and follow the lines below to configure the urls route <h2>
          <pre class="line-numbers"> 
            <code class="language-python">
          
              from django.urls import path,include
              from . import views
              urlpatterns=[
                  path('login',views.user_login,name='user_login'),
                  path('login1',views.manager_login,name='manager_login'),
                  path('signup',views.user_signup,name='user_signup'),
                  path('signup1',views.manager_signup,name='manager_signup'),
                  path('dashboard/',include('customer.urls')),
                  path('dashboard1/',include('Receptionist.urls')),
                  path('add-room/',include('Receptionist.urls'))
              ]
      
   </code>
</pre>
   <p>click <button>here</button> to download the Authentication app lofin, logout and manager_login  templates</p>
  












<h2>booking app models</h2>
<pre>
  <code>
    from django.db import models
from authentication.models import Customer,RoomManager
from datetime import date
class Contact(models.Model):
    name=models.CharField(max_length=100)
    email=models.CharField(max_length=100)
    message=models.TextField(max_length=2000)
    def __str__(self):
        return self.name
class Rooms(models.Model):
    manager=models.ForeignKey(RoomManager, on_delete=models.CASCADE)
    room_no=models.CharField(max_length=5, )
    room_type=models.CharField(max_length=50)
    is_available=models.BooleanField(default=True)
    price=models.FloatField(default=1000.00)
    no_of_days_advance=models.IntegerField()
    start_date=models.DateField(auto_now=False, auto_now_add=False)
    room_image=models.ImageField(upload_to="media", height_field=None, width_field=None, max_length=None,default='0.jpeg')
    def __str__(self):
        return "Room No: "+str(self.id)
'''
class RoomImage(models.Model):
    room=models.ForeignKey(Rooms, on_delete=models.CASCADE)
    room_image=models.ImageField(upload_to="media", height_field=None, width_field=None, max_length=None)
'''
class Booking(models.Model):
    room_no=models.ForeignKey(Rooms, on_delete=models.CASCADE)
    user_id=models.ForeignKey(Customer, on_delete=models.CASCADE)
    start_day=models.DateField(auto_now=False, auto_now_add=False)
    end_day=models.DateField(auto_now=False, auto_now_add=False)
    amount=models.FloatField()
    booked_on=models.DateTimeField(auto_now=True, auto_now_add=False)
    def __str__(self):
        return "Booking ID: "+str(self.id)
    @property
    def is_past_due(self):
        return date.today()>self.end_day
  </code>
</pre>

































    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->
  </div>
  </body>
</html>